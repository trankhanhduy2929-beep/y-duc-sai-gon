<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Y ĐỨC SÀI GÒN - Hệ thống dữ liệu nội bộ V3.3</title>
    
    <!-- Core Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --primary: #0EA5E9;
            --accent: #10B981;
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
            background-color: #0B1120; /* Default fallback */
            /* Force GPU Acceleration for the whole body to prevent painting issues */
            transform: translateZ(0); 
            backface-visibility: hidden;
        }

        .theme-dark { background-color: #0B1120; color: #F1F5F9; }
        .theme-light { background-color: #F0F4F8; color: #1E293B; }

        /* Glassmorphism Advanced - Optimized */
        .glass-panel {
            /* Reduced blur radius slightly for performance on lower-end GPUs */
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease, border-color 0.3s ease, transform 0.2s ease;
            will-change: transform, backdrop-filter;
        }

        .theme-light .glass-panel {
            background: rgba(255, 255, 255, 0.75);
            border-color: rgba(255, 255, 255, 0.9);
        }
        
        .theme-dark .glass-panel {
            background: rgba(15, 23, 42, 0.65);
            border-color: rgba(255, 255, 255, 0.1);
        }

        /* Modal Backdrop */
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        /* Scanline Animation - Optimized using transform */
        .scan-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, transparent, rgba(14, 165, 233, 0.05), transparent);
            opacity: 0.1;
            pointer-events: none;
            z-index: 1;
            animation: scan 8s linear infinite;
            will-change: transform;
        }

        @keyframes scan {
            0% { transform: translate3d(0, -100%, 0); }
            100% { transform: translate3d(0, 100%, 0); }
        }

        /* Logo Spin */
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .logo-spin {
            animation: spin-slow 25s linear infinite;
            will-change: transform;
        }

        /* Pixel Art Rendering */
        .pixelated {
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            will-change: transform;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(156, 163, 175, 0.3); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(59, 130, 246, 0.5); }
        
        /* Wallpaper Animation */
        .wallpaper-fade-in {
            animation: fadeIn 1.2s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(1.02); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Music Pulse Animation */
        @keyframes pulse-music {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .music-active {
            animation: pulse-music 2s infinite ease-in-out;
            color: #10B981;
        }

        /* Performance Utility */
        .gpu-accelerate {
            transform: translateZ(0);
            backface-visibility: hidden;
            perspective: 1000px;
        }
    </style>
</head>
<body class="theme-dark">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, memo } = React;
        const { motion, AnimatePresence, useMotionValue, useTransform, useSpring } = window.Motion;

        // --- ICONS (Memoized for Performance) ---
        const Icon = memo(({ name, size = 24, className = "" }) => {
            const icons = {
                Sun: <path d="M12 3V4M12 20V21M4.22 4.22l.71.71M18.36 18.36l.71.71M1 12H2M22 12H23M4.22 19.78l.71-.71M18.36 5.64l.71-.71M12 8a4 4 0 1 0 0 8 4 4 0 0 0 0-8z" />,
                Moon: <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />,
                Notebook: <React.Fragment><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20" /><path d="M8 7h6M8 11h8" /></React.Fragment>,
                Shield: <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />,
                Pill: <path d="m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z" />,
                Radio: <React.Fragment><circle cx="12" cy="12" r="2"/><path d="M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14"/></React.Fragment>,
                ArrowRight: <path d="M5 12h14M12 5l7 7-7 7" />,
                Users: <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2M9 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8z" />,
                Activity: <path d="M22 12h-4l-3 9L9 3l-3 9H2" />,
                FileSearch: <React.Fragment><path d="M4 22h14a2 2 0 0 0 2-2V7.5L14.5 2H6a2 2 0 0 0-2 2v4"/><path d="M14 2v6h6"/><circle cx="8" cy="14" r="4"/><path d="m11.5 17.5 3 3"/></React.Fragment>,
                Database: <React.Fragment><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></React.Fragment>,
                Cpu: <React.Fragment><rect x="4" y="4" width="16" height="16" rx="2" ry="2" /><rect x="9" y="9" width="6" height="6" /><path d="M9 1v3"/><path d="M15 1v3"/><path d="M9 20v3"/><path d="M15 20v3"/><path d="M20 9h3"/><path d="M20 14h3"/><path d="M1 9h3"/><path d="M1 14h3"/></React.Fragment>,
                Settings: <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" />,
                Clock: <React.Fragment><circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" /></React.Fragment>,
                Check: <polyline points="20 6 9 17 4 12" />,
                X: <React.Fragment><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></React.Fragment>,
                Image: <React.Fragment><rect x="3" y="3" width="18" height="18" rx="2" ry="2" /><circle cx="8.5" cy="8.5" r="1.5" /><polyline points="21 15 16 10 5 21" /></React.Fragment>,
                Music: <React.Fragment><path d="M9 18V5l12-2v13" /><circle cx="6" cy="18" r="3" /><circle cx="18" cy="16" r="3" /></React.Fragment>,
                MusicOff: <React.Fragment><line x1="1" y1="1" x2="23" y2="23" /><path d="M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4l-6 1.5" /></React.Fragment>
            };
            return (
                <svg viewBox="0 0 24 24" width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || <circle cx="12" cy="12" r="10" />}
                </svg>
            );
        });

        // --- COMPONENTS ---

        const Toggle = memo(({ label, checked, onChange, theme }) => (
            <div className="flex items-center justify-between py-3 border-b border-gray-100/10">
                <span className={`font-medium ${theme === 'dark' ? 'text-slate-300' : 'text-slate-600'}`}>{label}</span>
                <button 
                    onClick={() => onChange(!checked)}
                    className={`w-12 h-6 rounded-full p-1 transition-colors duration-300 flex items-center ${checked ? 'bg-blue-500' : 'bg-gray-400/30'}`}
                >
                    <motion.div 
                        layout 
                        className="w-4 h-4 rounded-full bg-white shadow-sm"
                        animate={{ x: checked ? 24 : 0 }}
                        transition={{ type: "spring", stiffness: 500, damping: 30 }}
                    />
                </button>
            </div>
        ));

        const DigitalClock = memo(({ theme }) => {
            const [time, setTime] = useState(new Date());

            useEffect(() => {
                const timer = setInterval(() => setTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            return (
                <div className={`flex items-center gap-2 px-3 py-1 rounded-lg border backdrop-blur-md shadow-sm ${theme === 'dark' ? 'bg-slate-800/60 border-white/20 text-blue-300' : 'bg-white/70 border-white/60 text-blue-600'}`}>
                    <Icon name="Clock" size={14} />
                    <span className="text-xs font-mono font-bold pt-0.5">
                        {time.toLocaleTimeString('vi-VN')} - {time.toLocaleDateString('vi-VN')}
                    </span>
                </div>
            );
        });

        const MusicPlayer = memo(({ isPlaying, volume = 0.5 }) => {
            const audioRef = useRef(null);
            const AUDIO_SRC = "https://cdn.pixabay.com/audio/2022/05/27/audio_1808fbf07a.mp3"; 

            useEffect(() => {
                if (audioRef.current) {
                    audioRef.current.volume = volume;
                    if (isPlaying) {
                        audioRef.current.play().catch(() => {});
                    } else {
                        audioRef.current.pause();
                    }
                }
            }, [isPlaying, volume]);

            return (
                <audio ref={audioRef} loop>
                    <source src={AUDIO_SRC} type="audio/mpeg" />
                </audio>
            );
        });

        const WallpaperLayer = memo(({ enabled, theme }) => {
            const [wallpaperUrl, setWallpaperUrl] = useState('');
            
            useEffect(() => {
                if (enabled) {
                    const wallpapers = [
                        "https://images.unsplash.com/photo-1477346611705-65d1883cee1e", // Dark Mountains
                        "https://images.unsplash.com/photo-1451187580459-43490279c0fa", // Space
                        "https://images.unsplash.com/photo-1506744038136-46273834b3fb", // Landscape River
                        "https://images.unsplash.com/photo-1550684848-fac1c5b4e853", // Cyberpunk City
                        "https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe", // Abstract Liquid
                        "https://images.unsplash.com/photo-1493246507139-91e8fad9978e", // Alpine Lake
                        "https://images.unsplash.com/photo-1519681393798-3828fb4090bb", // Night Sky
                        "https://images.unsplash.com/photo-1518818419601-72c8673f5852"  // Neon Tech
                    ];
                    // Optimized Size Params: w=2560 (2K+) q=80 (High Quality) auto=format (WebP if supported)
                    const random = wallpapers[Math.floor(Math.random() * wallpapers.length)] + "?q=80&w=2560&auto=format&fit=crop";
                    setWallpaperUrl(random);
                }
            }, [enabled]);

            if (!enabled || !wallpaperUrl) return null;

            return (
                <div className="fixed inset-0 z-[-1] overflow-hidden gpu-accelerate">
                    <img 
                        src={wallpaperUrl} 
                        alt="Background" 
                        decoding="async"
                        loading="eager"
                        className="absolute inset-0 w-full h-full object-cover wallpaper-fade-in will-change-transform"
                    />
                    <div className={`absolute inset-0 transition-colors duration-500 ${theme === 'dark' ? 'bg-slate-900/80' : 'bg-white/60'} backdrop-blur-[2px]`} />
                </div>
            );
        });

        // Optimized Interactive Background using useSpring instead of raw MotionValue
        const InteractiveBackground = memo(({ enabled }) => {
            const mouseX = useMotionValue(0);
            const mouseY = useMotionValue(0);

            // Smooth spring animation to reduce jitter and calculation
            const smoothX = useSpring(mouseX, { stiffness: 50, damping: 20 });
            const smoothY = useSpring(mouseY, { stiffness: 50, damping: 20 });

            useEffect(() => {
                if (!enabled) return;
                const handleMouseMove = (e) => {
                    mouseX.set(e.clientX);
                    mouseY.set(e.clientY);
                };
                window.addEventListener("mousemove", handleMouseMove);
                return () => window.removeEventListener("mousemove", handleMouseMove);
            }, [enabled]);

            const x1 = useTransform(smoothX, [0, window.innerWidth], [-30, 30]); // Reduced range for performance
            const y1 = useTransform(smoothY, [0, window.innerHeight], [-30, 30]);
            const x2 = useTransform(smoothX, [0, window.innerWidth], [30, -30]);
            const y2 = useTransform(smoothY, [0, window.innerHeight], [30, -30]);

            if (!enabled) return null;

            return (
                <div className="fixed inset-0 z-0 overflow-hidden pointer-events-none gpu-accelerate">
                    <div className="absolute inset-0 opacity-[0.03]" 
                        style={{ 
                            backgroundImage: `linear-gradient(currentColor 1px, transparent 1px), linear-gradient(90deg, currentColor 1px, transparent 1px)`,
                            backgroundSize: '40px 40px' 
                        }}
                    ></div>
                    <motion.div 
                        style={{ x: x1, y: y1 }}
                        className="absolute top-[-10%] left-[-10%] w-[50vw] h-[50vw] bg-blue-600/20 rounded-full blur-[80px] will-change-transform" 
                        animate={{ scale: [1, 1.05, 1], opacity: [0.2, 0.25, 0.2] }}
                        transition={{ duration: 10, repeat: Infinity, ease: "linear" }}
                    />
                    <motion.div 
                        style={{ x: x2, y: y2 }}
                        className="absolute bottom-[-10%] right-[-10%] w-[50vw] h-[50vw] bg-emerald-500/10 rounded-full blur-[80px] will-change-transform" 
                        animate={{ scale: [1, 1.1, 1], opacity: [0.1, 0.15, 0.1] }}
                        transition={{ duration: 12, repeat: Infinity, ease: "linear", delay: 1 }}
                    />
                    <div className="scan-line"></div>
                </div>
            );
        });

        const PokemonLayer = memo(({ enabled }) => {
            if (!enabled) return null;
            return (
                <div className="fixed inset-0 pointer-events-none z-20 overflow-hidden gpu-accelerate">
                    <motion.div className="absolute bottom-0 left-0 w-full h-16 will-change-transform">
                         <motion.img 
                            src="https://img.pokemondb.net/sprites/black-white/anim/normal/pikachu.gif"
                            alt="Pikachu"
                            className="absolute bottom-1 w-12 h-12 md:w-16 md:h-16 object-contain pixelated pointer-events-auto cursor-pointer"
                            initial={{ x: "-10vw" }}
                            animate={{ 
                                x: ["-10vw", "110vw", "110vw", "-10vw", "-10vw"],
                                scaleX: [1, 1, -1, -1, 1]
                            }}
                            transition={{ 
                                duration: 30, // Slower for less painting
                                ease: "linear", 
                                repeat: Infinity,
                                times: [0, 0.45, 0.5, 0.95, 1]
                            }}
                            whileHover={{ scale: 1.2, y: -10 }}
                            whileTap={{ scale: 0.9, y: 0 }}
                        />
                    </motion.div>

                    <motion.img 
                        src="https://img.pokemondb.net/sprites/black-white/anim/normal/mew.gif"
                        alt="Mew"
                        className="absolute top-20 w-10 h-10 md:w-14 md:h-14 object-contain opacity-60 hover:opacity-100 transition-opacity pixelated pointer-events-auto cursor-pointer will-change-transform"
                        animate={{ 
                            x: ["5vw", "85vw", "40vw", "90vw", "5vw"],
                            y: ["15vh", "25vh", "10vh", "35vh", "15vh"],
                            rotate: [0, 10, -10, 5, 0]
                        }}
                        transition={{ 
                            duration: 45, 
                            ease: "linear", 
                            repeat: Infinity,
                        }}
                        whileHover={{ scale: 1.3, rotate: 360, transition: { duration: 0.5 } }}
                    />
                    
                    <motion.img 
                        src="https://img.pokemondb.net/sprites/black-white/anim/normal/eevee.gif"
                        alt="Eevee"
                        className="absolute bottom-2 right-10 w-10 h-10 md:w-14 md:h-14 object-contain pixelated pointer-events-auto cursor-pointer will-change-transform"
                        animate={{ y: [0, -3, 0] }}
                        transition={{ duration: 2, repeat: Infinity, ease: "easeInOut" }}
                        whileHover={{ scale: 1.2, rotate: [0, -10, 10, 0] }}
                    />
                </div>
            )
        });

        const SystemTicker = memo(({ theme }) => {
            return (
                <div className={`w-full overflow-hidden border-b py-1.5 backdrop-blur-md ${theme === 'dark' ? 'bg-slate-900/80 border-white/5 text-blue-400' : 'bg-white/80 border-slate-200 text-blue-600'}`}>
                    <div className="flex whitespace-nowrap">
                        <motion.div 
                            animate={{ x: [0, -1000] }} 
                            transition={{ repeat: Infinity, duration: 25, ease: "linear" }}
                            className="flex items-center gap-8 text-[10px] font-bold uppercase tracking-widest will-change-transform"
                        >
                            {[1,2,3,4].map(i => (
                                <React.Fragment key={i}>
                                    <span className="flex items-center gap-2">
                                        <span className="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></span>
                                        Hệ thống hoạt động bình thường
                                    </span>
                                    <span className="opacity-30">|</span>
                                    <span>Đã lưu cấu hình người dùng</span>
                                    <span className="opacity-30">|</span>
                                    <span>Bảo mật: Encypted AES-256</span>
                                    <span className="opacity-30">|</span>
                                    <span>Phiên bản: 3.3 (Optimized)</span>
                                    <span className="opacity-30">|</span>
                                </React.Fragment>
                            ))}
                        </motion.div>
                    </div>
                </div>
            );
        });

        const TiltCard = memo(({ children, className, href, enabled }) => {
            const x = useMotionValue(0);
            const y = useMotionValue(0);
            
            // Reduced tilt range slightly for smoother performance
            const rotateX = useTransform(y, [-100, 100], [3, -3]);
            const rotateY = useTransform(x, [-100, 100], [-3, 3]);

            if (!enabled) {
                return (
                    <a href={href} className={className}>
                        {children}
                    </a>
                )
            }

            return (
                <motion.a 
                    href={href}
                    style={{ rotateX, rotateY, perspective: 1000 }}
                    onMouseMove={(e) => {
                        const rect = e.currentTarget.getBoundingClientRect();
                        // Simple calculations, no heavy logic
                        x.set(e.clientX - (rect.left + rect.width / 2));
                        y.set(e.clientY - (rect.top + rect.height / 2));
                    }}
                    onMouseLeave={() => { x.set(0); y.set(0); }}
                    whileHover={{ scale: 1.01, z: 20 }}
                    whileTap={{ scale: 0.98 }}
                    className={`${className} will-change-transform`}
                >
                    {children}
                </motion.a>
            );
        });

        const SettingsModal = ({ isOpen, onClose, settings, updateSettings, theme }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center modal-backdrop p-4">
                    <motion.div 
                        initial={{ scale: 0.9, opacity: 0 }}
                        animate={{ scale: 1, opacity: 1 }}
                        className={`w-full max-w-md rounded-2xl p-6 shadow-2xl glass-panel ${theme === 'dark' ? 'text-white' : 'text-slate-900'}`}
                    >
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-xl font-bold flex items-center gap-2">
                                <Icon name="Settings" /> Cài đặt hệ thống
                            </h2>
                            <button onClick={onClose} className="p-2 hover:bg-white/10 rounded-full transition-colors">
                                <Icon name="X" size={20} />
                            </button>
                        </div>

                        <div className="space-y-2">
                            <Toggle 
                                label="Hình nền 4K ngẫu nhiên" 
                                checked={settings.showWallpaper} 
                                onChange={(v) => updateSettings('showWallpaper', v)} 
                                theme={theme}
                            />
                            <Toggle 
                                label="Tự động phát nhạc khi mở (Chill)" 
                                checked={settings.autoPlayMusic} 
                                onChange={(v) => updateSettings('autoPlayMusic', v)} 
                                theme={theme}
                            />
                            <Toggle 
                                label="Hiển thị Pokemon" 
                                checked={settings.showPokemon} 
                                onChange={(v) => updateSettings('showPokemon', v)} 
                                theme={theme}
                            />
                            <Toggle 
                                label="Hiển thị Đồng hồ" 
                                checked={settings.showTime} 
                                onChange={(v) => updateSettings('showTime', v)} 
                                theme={theme}
                            />
                            <Toggle 
                                label="Hiệu ứng nền (Particles)" 
                                checked={settings.showParticles} 
                                onChange={(v) => updateSettings('showParticles', v)} 
                                theme={theme}
                            />
                            <Toggle 
                                label="Hiệu ứng 3D thẻ (Tilt Effect)" 
                                checked={settings.enableTilt} 
                                onChange={(v) => updateSettings('enableTilt', v)} 
                                theme={theme}
                            />
                        </div>

                        <div className="mt-6 pt-4 border-t border-white/10 text-xs opacity-60 text-center">
                            Dữ liệu cấu hình sẽ được tự động lưu lại.
                            <br/>
                            <span className="text-emerald-500 font-semibold">Tip: F5 để đổi hình nền mới</span>
                        </div>
                    </motion.div>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [theme, setTheme] = useState(() => localStorage.getItem('yduc-theme') || 'dark');
            const [activeDept, setActiveDept] = useState(() => localStorage.getItem('yduc-dept') || 'all');
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            
            // Default Settings (Updated with showWallpaper)
            const [settings, setSettings] = useState(() => {
                const saved = localStorage.getItem('yduc-settings-v3.3'); // Version bump for fresh settings
                return saved ? JSON.parse(saved) : {
                    showWallpaper: true,
                    showPokemon: true,
                    showTime: true,
                    showParticles: true,
                    enableTilt: true,
                    autoPlayMusic: false 
                };
            });

            // Music State
            const [isMusicPlaying, setIsMusicPlaying] = useState(false);

            // Auto Play Logic
            useEffect(() => {
                if (settings.autoPlayMusic) {
                    setIsMusicPlaying(true);
                }
            }, []); 

            const COPYRIGHT = "© 2026 Phòng Khám Đa Khoa Y Đức Sài Gòn - Powered by Trần Khánh Duy";
            const LOGO_URL = "logo.jpg";

            useEffect(() => {
                document.body.className = theme === 'dark' ? 'theme-dark' : 'theme-light';
                localStorage.setItem('yduc-theme', theme);
            }, [theme]);

            useEffect(() => {
                localStorage.setItem('yduc-dept', activeDept);
            }, [activeDept]);

            useEffect(() => {
                localStorage.setItem('yduc-settings-v3.3', JSON.stringify(settings));
            }, [settings]);

            const updateSettings = (key, value) => {
                setSettings(prev => ({ ...prev, [key]: value }));
                if (key === 'autoPlayMusic' && value === true) {
                    setIsMusicPlaying(true);
                }
            };

            const toggleMusic = () => {
                setIsMusicPlaying(!isMusicPlaying);
            };

            const departments = [
                { id: 'all', name: 'Tất cả' },
                { id: 'cskh', name: 'CSKH' },
                { id: 'bhyt', name: 'Bảo hiểm' },
                { id: 'ungdung', name: 'Ứng dụng' },
                { id: 'media', name: 'Truyền thông' }
            ];

            const apps = useMemo(() => [
                { id: 1, dept: 'cskh', name: "Đối Soát CSKH", description: "Phân tích hồ sơ bệnh án, lọc BHYT & Dịch vụ chuyên dụng.", icon: "Notebook", link: "./cskh/index.html", color: "from-blue-500 to-blue-700", tag: "V10" },
                { id: 2, dept: 'bhyt', name: "Dò số lượng bảng kê cổng", description: "Dò số lượng bệnh BHYT từ VNPT HIS so với cổng giám định.", icon: "FileSearch", link: "./bhyt/app1/index.html", color: "from-indigo-500 to-indigo-700", tag: "App 1" },
                { id: 3, dept: 'bhyt', name: "Dò điện châm", description: "Hệ thống đối soát chỉ định điện châm YHCT, thiếu mã máy, người thực hiện.", icon: "Shield", link: "./bhyt/app2/index.html", color: "from-cyan-500 to-blue-700", tag: "App 2" },
                { id: 4, dept: 'bhyt', name: "Dò ICD Gan-Đường", description: "Kiểm tra thiếu mã ICD các bệnh lý gan, đường HBA1C.", icon: "Activity", link: "./bhyt/app3/index.html", color: "from-teal-500 to-emerald-700", tag: "App 3" },
                { id: 5, dept: 'bhyt', name: "K.BHYT Cơ Bản", description: "Hệ thống đối soát quy trình khám BHYT mức cơ bản.", icon: "Database", link: "./bhyt/app4/index.html", color: "from-violet-500 to-purple-700", tag: "App 4" },
                { id: 6, dept: 'bhyt', name: "CHECK GIỜ CHẤM CÔNG", description: "Module kiểm tra thời gian đầu cuối theo bác sỹ", icon: "Shield", link: "./bhyt/app5/index.html", color: "from-fuchsia-500 to-pink-700", tag: "App 5" },
                { id: 7, dept: 'bhyt', name: "Dò Mã Máy CLS", description: "Tra cứu và đồng bộ mã máy Cận lâm sàng.", icon: "FileSearch", link: "./bhyt/app6/index.html", color: "from-sky-500 to-blue-600", tag: "App 6" },
                { id: 8, dept: 'bhyt', name: "Dò Bác Sỹ Chồng Giờ", description: "Dò bác sĩ khám chồng giờ cận lâm sàng hoặc y lệnh.", icon: "FileSearch", link: "./bhyt/app7/index.html", color: "from-sky-500 to-blue-600", tag: "App 7" },
                { id: 9, dept: 'bhyt', name: "Dò Bác Sỹ Trùng Giờ", description: "Dò trùng giờ công khám, thuốc, điện tim, CLS.", icon: "Activity", link: "./bhyt/app8/index.html", color: "from-teal-500 to-emerald-700", tag: "App 8" },   
                { id: 10, dept: 'bhyt', name: "Dò TPTT Tế Bào Máu", description: "Dò trùng giờ thực hiện/kết quả TPTTBM.", icon: "Database", link: "./bhyt/app9/index.html", color: "from-violet-500 to-purple-700", tag: "App 9" },
                { id: 11, dept: 'bhyt', name: "Dò ICD Sỏi-Gout-12 mã", description: "Dò trên 12 mã ICD, tương tác sỏi, acid uric.", icon: "Cpu", link: "./bhyt/app10/index.html", color: "from-violet-500 to-purple-700", tag: "App 10" },
                { id: 12, dept: 'bhyt', name: "Dò Thời Gian CLS", description: "Kiểm tra logic thời gian thực hiện - kết thúc.", icon: "Database", link: "./bhyt/app11/index.html", color: "from-violet-500 to-purple-700", tag: "App 11" },
                { id: 100, dept: 'ungdung', name: "Dò Excel Vlookup", description: "Dò hai nguồn dữ liệu excel nhanh.", icon: "Pill", link: "./ungdung/app1/index.html", color: "from-emerald-500 to-teal-700", tag: "Tool" },
                { id: 101, dept: 'ungdung', name: "Máy tính Casio Pro", description: "Tính toán bằng Casio", icon: "Pill", link: "./ungdung/app2/index.html", color: "from-emerald-500 to-teal-700", tag: "Stats" },
                { id: 200, dept: 'media', name: "Website Chính", description: "Quản lý tài nguyên & phản hồi MXH.", icon: "Radio", link: "https://phongkhamyducsaigon.com/", color: "from-rose-500 to-red-700", tag: "Web" },
                { id: 300, dept: 'cskh', name: "Chỉ Số Hài Lòng", description: "Báo cáo mức độ hài lòng người bệnh.", icon: "Users", link: "#", color: "from-amber-500 to-orange-600", tag: "Survey" },
                { id: 301, dept: 'media', name: "Tin Tức Y Đức", description: "Bảng tin nội bộ & thông báo điều hành.", icon: "Notebook", link: "https://phongkhamyducsaigon.com/", color: "from-slate-500 to-gray-700", tag: "News" }
            ], []);

            const filteredApps = useMemo(() => {
                return activeDept === 'all' ? apps : apps.filter(a => a.dept === activeDept);
            }, [activeDept, apps]);

            return (
                <div className="min-h-screen flex flex-col relative overflow-hidden text-sm md:text-base transition-colors duration-500">
                    <MusicPlayer isPlaying={isMusicPlaying} />

                    <WallpaperLayer enabled={settings.showWallpaper} theme={theme} />
                    <InteractiveBackground enabled={settings.showParticles} />
                    <PokemonLayer enabled={settings.showPokemon} />
                    
                    <SettingsModal isOpen={isSettingsOpen} onClose={() => setIsSettingsOpen(false)} settings={settings} updateSettings={updateSettings} theme={theme} />

                    <header className={`sticky top-0 z-50 transition-all duration-500 ${theme === 'dark' ? 'bg-slate-900/80 border-b border-white/10' : 'bg-white/80 border-b border-white/40'} backdrop-blur-xl`}>
                        <SystemTicker theme={theme} />
                        
                        <div className="px-6 py-4">
                            <div className="max-w-[1400px] mx-auto flex justify-between items-center">
                                {/* Logo */}
                                <div className="flex items-center gap-4 cursor-pointer group">
                                    <div className="relative w-12 h-12 md:w-14 md:h-14 flex-shrink-0">
                                        <div className="absolute inset-0 bg-blue-500 rounded-full blur opacity-20 group-hover:opacity-50 transition-opacity duration-500"></div>
                                        <img 
                                            src={LOGO_URL} 
                                            alt="Logo" 
                                            className="w-full h-full object-cover rounded-full border-2 border-white/10 shadow-lg logo-spin"
                                            onError={(e) => { e.target.onerror = null; e.target.src = "https://ui-avatars.com/api/?name=Y+D&background=0D8ABC&color=fff"; }}
                                        />
                                    </div>
                                    <div className="flex flex-col">
                                        <h1 className={`text-base md:text-xl font-bold tracking-tight uppercase leading-tight ${theme === 'dark' ? 'text-white' : 'text-slate-900'} drop-shadow-md`}>
                                            PKĐK <span className="text-blue-500">Y ĐỨC SÀI GÒN</span>
                                        </h1>
                                        <div className="flex items-center gap-2">
                                            <span className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                                            <p className={`text-[10px] font-bold uppercase tracking-widest ${theme === 'dark' ? 'text-slate-400' : 'text-slate-600'}`}>System Online</p>
                                        </div>
                                    </div>
                                </div>

                                {/* Controls */}
                                <div className="flex items-center gap-3 md:gap-4">
                                    {settings.showTime && <div className="hidden lg:block"><DigitalClock theme={theme} /></div>}
                                    
                                    <button 
                                        onClick={toggleMusic}
                                        className={`p-2.5 rounded-full border transition-all duration-300 hover:scale-110 ${
                                            theme === 'dark' 
                                                ? 'bg-white/10 border-white/10 text-slate-300 hover:bg-white/20' 
                                                : 'bg-white/70 border-white/60 text-slate-700 shadow-sm hover:bg-white'
                                        } ${isMusicPlaying ? 'music-active border-emerald-500/50 text-emerald-500' : ''}`}
                                        title={isMusicPlaying ? "Tắt nhạc" : "Bật nhạc Chill"}
                                    >
                                        <Icon name={isMusicPlaying ? "Music" : "MusicOff"} size={20} />
                                    </button>

                                    <button 
                                        onClick={() => setIsSettingsOpen(true)}
                                        className={`p-2.5 rounded-full border transition-all duration-300 hover:rotate-90 ${theme === 'dark' ? 'bg-white/10 border-white/10 text-slate-300 hover:bg-white/20' : 'bg-white/70 border-white/60 text-slate-700 shadow-sm hover:bg-white'}`}
                                        title="Cài đặt"
                                    >
                                        <Icon name="Settings" size={20} />
                                    </button>

                                    <button 
                                        onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')}
                                        className={`p-2.5 rounded-full border transition-all duration-300 hover:scale-110 ${theme === 'dark' ? 'bg-white/10 border-white/10 text-yellow-400 hover:bg-white/20' : 'bg-white/70 border-white/60 text-slate-700 shadow-sm hover:bg-white'}`}
                                        title="Đổi giao diện"
                                    >
                                        <Icon name={theme === 'dark' ? 'Sun' : 'Moon'} size={20} />
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-[1400px] mx-auto p-6 md:p-10 flex-1 w-full relative z-10 flex flex-col items-center">
                        {/* Hero Section */}
                        <div className="mb-12 flex flex-col items-center text-center w-full">
                            <motion.div 
                                initial={{ y: 20, opacity: 0 }} 
                                animate={{ y: 0, opacity: 1 }} 
                                transition={{ duration: 0.7 }}
                                className="space-y-4 relative"
                            >
                                <span className={`relative inline-block px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest border backdrop-blur-md shadow-sm ${theme === 'dark' ? 'border-blue-500/30 bg-blue-500/10 text-blue-400' : 'border-blue-200 bg-white/50 text-blue-600'} mb-2`}>
                                    Internal Data Center V3.3
                                </span>
                                <h2 className={`relative text-4xl md:text-6xl font-black uppercase tracking-tight drop-shadow-sm ${theme === 'dark' ? 'text-white' : 'text-slate-900'}`}>
                                    Trung tâm <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-indigo-400 to-emerald-400">Điều Hành</span>
                                </h2>
                            </motion.div>

                            {/* Filter Tabs */}
                            <motion.div 
                                initial={{ y: 20, opacity: 0 }}
                                animate={{ y: 0, opacity: 1 }}
                                transition={{ delay: 0.2 }}
                                className="mt-8 flex flex-wrap justify-center gap-2 p-1.5 rounded-2xl border glass-panel sticky top-24 z-40" 
                            >
                                {departments.map(dept => (
                                    <button 
                                        key={dept.id}
                                        onClick={() => setActiveDept(dept.id)}
                                        className={`relative px-5 py-2.5 rounded-xl text-[11px] font-bold uppercase tracking-wider transition-all duration-300 ${
                                            activeDept === dept.id 
                                            ? 'bg-blue-600 text-white shadow-lg shadow-blue-500/25' 
                                            : theme === 'dark' ? 'text-slate-300 hover:text-white hover:bg-white/5' : 'text-slate-600 hover:text-slate-900 hover:bg-slate-200/50'
                                        }`}
                                    >
                                        {dept.name}
                                        {activeDept === dept.id && (
                                            <motion.div layoutId="activeTab" className="absolute inset-0 border-2 border-white/20 rounded-xl" />
                                        )}
                                    </button>
                                ))}
                            </motion.div>
                        </div>

                        {/* Grid Apps */}
                        <motion.div layout className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 w-full pb-20">
                            <AnimatePresence mode='popLayout'>
                                {filteredApps.map((app, idx) => (
                                    <TiltCard
                                        key={app.id}
                                        href={app.link}
                                        enabled={settings.enableTilt}
                                        className={`glass-panel p-6 rounded-[24px] flex flex-col group relative overflow-hidden min-h-[220px] transition-colors duration-300 hover:border-blue-500/30`}
                                    >
                                        <div className={`absolute -right-10 -top-10 w-40 h-40 bg-gradient-to-br ${app.color} opacity-10 rounded-full blur-2xl group-hover:scale-150 group-hover:opacity-20 transition-all duration-700`}></div>

                                        <div className="flex justify-between items-start mb-6 relative z-10">
                                            <div className={`w-14 h-14 rounded-2xl bg-gradient-to-br ${app.color} flex items-center justify-center shadow-lg text-white group-hover:scale-110 group-hover:rotate-6 transition-all duration-500`}>
                                                <Icon name={app.icon} size={28} />
                                            </div>
                                            <span className={`text-[9px] font-bold px-2 py-1 rounded-lg border uppercase tracking-widest backdrop-blur-sm ${theme === 'dark' ? 'bg-white/5 border-white/5 text-slate-400' : 'bg-white/50 border-white/40 text-slate-600'}`}>
                                                {app.tag}
                                            </span>
                                        </div>

                                        <div className="space-y-3 flex-1 relative z-10">
                                            <h3 className={`text-lg font-bold leading-tight group-hover:text-blue-500 transition-colors ${theme === 'dark' ? 'text-slate-100' : 'text-slate-800'}`}>
                                                {app.name}
                                            </h3>
                                            <p className={`text-xs leading-relaxed font-medium line-clamp-2 ${theme === 'dark' ? 'text-slate-400' : 'text-slate-500'}`}>
                                                {app.description}
                                            </p>
                                        </div>

                                        <div className={`mt-6 pt-4 border-t flex items-center justify-between transition-all ${theme === 'dark' ? 'border-white/5 text-slate-500' : 'border-slate-400/20 text-slate-500'}`}>
                                            <span className="text-[9px] font-bold uppercase tracking-[0.2em] group-hover:text-blue-500 transition-colors">Access</span>
                                            <motion.div 
                                                className="w-8 h-8 rounded-full flex items-center justify-center bg-transparent group-hover:bg-blue-500 group-hover:text-white transition-all"
                                                whileHover={{ x: 5 }}
                                            >
                                                <Icon name="ArrowRight" size={16} />
                                            </motion.div>
                                        </div>
                                    </TiltCard>
                                ))}
                            </AnimatePresence>
                        </motion.div>
                    </main>

                    {/* Footer */}
                    <footer className={`mt-auto py-6 text-center border-t relative z-10 transition-colors duration-500 ${theme === 'dark' ? 'bg-slate-900/50 border-white/5' : 'bg-white/30 border-white/40'} backdrop-blur-md`}>
                        <div className="max-w-7xl mx-auto px-6 flex flex-col items-center gap-3">
                            <div className="flex items-center gap-3 opacity-30">
                                <div className={`h-px w-16 bg-gradient-to-r from-transparent ${theme === 'dark' ? 'to-blue-400' : 'to-slate-900'}`}></div>
                                <Icon name="Shield" size={14} />
                                <div className={`h-px w-16 bg-gradient-to-l from-transparent ${theme === 'dark' ? 'to-blue-400' : 'to-slate-900'}`}></div>
                            </div>
                            <p className={`text-[10px] font-bold uppercase tracking-[0.2em] opacity-50 hover:opacity-100 transition-opacity cursor-default ${theme === 'dark' ? 'text-white' : 'text-slate-900'}`}>{COPYRIGHT}</p>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


