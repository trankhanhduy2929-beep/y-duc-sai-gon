<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công Cụ Nhập Liệu Import Thuốc</title>
    
    <!-- Phông chữ Inter hiện đại -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Thư viện giao diện Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Cấu hình Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Thư viện React chạy trực tiếp trên trình duyệt -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom Scrollbar cho trải nghiệm mượt mà */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9; 
            border-radius: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 8px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-up {
            animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        
        /* Glassmorphism */
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* Input Focus Style */
        .input-modern {
            transition: all 0.2s ease-in-out;
        }
        .input-modern:focus {
            background-color: #ffffff;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
            border-color: #3b82f6;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 antialiased selection:bg-brand-200 selection:text-brand-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Cấu trúc cột chuẩn xác từ file mẫu
        const CSV_HEADERS = [
          "MA_NHOM", "MA_LOAI", "MA_HOAT_CHAT", "HOAT_CHAT", "STT", "MA_ACT", "MA_BYT",
          "SO_DANG_KY", "MA_THUOC", "TEN_THUOC", "HAM_LUONG", "DON_VI_TINH", "DONG_GOI",
          "MA_DUONG_DUNG", "DUONG_DUNG", "LIEU_LUONG", "HANG_SX", "NUOC_SX", "NHA_CUNG_CAP",
          "MA_NHOM_THAU", "GOI_THAU", "SO_GOI_THAU", "DANGBAOCHE", "TYLEHUHAO", "QUYET_DINH",
          "CONG_BO", "STT_THAU", "TEN_GIAM_DINH_BH", "BHYT_CHI_TRA", "GIA_BHYT_QUYET_TOAN",
          "GIA_THAU", "GIA_BAN", "MA_THUOC_BV", "GIA_BHYT", "GIA_DICH_VU", "NGUONCT",
          "THUOCPHONGXA", "DUOCPHEPKELE", "VITHUOCYHCT", "KETRUNGHOATCHAT", "THUOCTANDUOC",
          "CHEPHAMYHCT", "THUOCKHANGSINH", "KHONGTINHXNT", "DANHSTTDUNGTHUOC", "THUOCNHIEUHOATCHAT",
          "THUOCKEDON", "TIENCHATGNHT", "QLTHEOTUIMAU", "DUOCDUYETLE", "THUOCDIEUTRILAO",
          "THUOCCORTICOID", "SOGIAYPHEP", "NHOM_BHXH", "THAUGHEP", "MA_PP_CHEBIEN", "MAHIEUSP",
          "MA_NHOM_VTYT", "TEN_VTYT"
        ];

        // Từ điển ánh xạ Đường dùng -> Mã đường dùng (Dựa trên chuẩn BYT)
        const DUONG_DUNG_MAPPING = [
          { name: '', code: '' },
          { name: 'Uống', code: '1.01' },
          { name: 'Tiêm', code: '1.02' },
          { name: 'Tiêm bắp', code: '1.03' },
          { name: 'Tiêm tĩnh mạch', code: '1.04' },
          { name: 'Tiêm dưới da', code: '1.05' },
          { name: 'Tiêm truyền tĩnh mạch', code: '1.06' },
          { name: 'Ngậm', code: '1.07' },
          { name: 'Dùng ngoài', code: '2.01' },
          { name: 'Bôi', code: '2.02' },
          { name: 'Nhỏ mắt', code: '3.01' },
          { name: 'Nhỏ tai', code: '3.02' },
          { name: 'Nhỏ mũi', code: '3.03' },
          { name: 'Đặt âm đạo', code: '4.01' },
          { name: 'Đặt hậu môn', code: '4.02' },
          { name: 'Hô hấp', code: '5.01' },
          { name: 'Xông hít', code: '5.02' }
        ];

        function App() {
          const [isAuthenticated, setIsAuthenticated] = useState(false);
          const [passwordInput, setPasswordInput] = useState("");

          const [dataList, setDataList] = useState([]);
          
          // Khởi tạo form rỗng
          const initialForm = {
            STT: "",
            HOAT_CHAT: "",
            TEN_THUOC: "",
            SO_DANG_KY: "",
            HAM_LUONG: "",
            DON_VI_TINH: "viên",
            DONG_GOI: "Hộp 10 vỉ x 10 viên",
            DUONG_DUNG: "",
            MA_DUONG_DUNG: "",
            HANG_SX: "",
            NUOC_SX: "VIỆT NAM",
            NHA_CUNG_CAP: "",
            GIA_BAN: "",
            GIA_THAU: ""
          };
          
          const [formData, setFormData] = useState(initialForm);
          const [notification, setNotification] = useState("");
          const [editingIndex, setEditingIndex] = useState(null);

          // Load dữ liệu từ LocalStorage khi khởi chạy
          useEffect(() => {
            const authStatus = sessionStorage.getItem('pharmaAuth');
            if (authStatus === 'true') {
              setIsAuthenticated(true);
            }

            const savedData = localStorage.getItem('pharmaImportData');
            if (savedData) {
              try {
                setDataList(JSON.parse(savedData));
              } catch (e) {
                console.error("Lỗi khi đọc dữ liệu", e);
              }
            }
          }, []);

          // Hàm hiển thị thông báo
          const showNotification = (msg) => {
            setNotification(msg);
            setTimeout(() => setNotification(""), 4000);
          };

          // Xử lý thay đổi input
          const handleInputChange = (e) => {
            const { name, value } = e.target;
            
            if (name === "DUONG_DUNG") {
              const selectedMapping = DUONG_DUNG_MAPPING.find(d => d.name === value);
              setFormData({
                ...formData,
                [name]: value,
                MA_DUONG_DUNG: selectedMapping ? selectedMapping.code : formData.MA_DUONG_DUNG
              });
            } else {
              setFormData({ ...formData, [name]: value });
            }
          };

          // Xử lý Thêm mới
          const handleSubmit = (e) => {
            e.preventDefault();
            
            // Ràng buộc tất cả các trường phải có dữ liệu
            const requiredFields = [
              { key: 'STT', name: 'Số Thứ Tự' },
              { key: 'TEN_THUOC', name: 'Tên Thuốc Thương Mại' },
              { key: 'HOAT_CHAT', name: 'Hoạt Chất Chính' },
              { key: 'SO_DANG_KY', name: 'Số Đăng Ký' },
              { key: 'HAM_LUONG', name: 'Hàm Lượng' },
              { key: 'DON_VI_TINH', name: 'Đơn Vị Tính' },
              { key: 'DONG_GOI', name: 'Đóng Gói' },
              { key: 'DUONG_DUNG', name: 'Đường Dùng' },
              { key: 'HANG_SX', name: 'Hãng Sản Xuất' },
              { key: 'NUOC_SX', name: 'Quốc Gia' },
              { key: 'NHA_CUNG_CAP', name: 'Nhà Cung Cấp / Nhập Khẩu' },
              { key: 'GIA_BAN', name: 'Giá Đề Xuất (VNĐ)' }
            ];

            const missingFields = requiredFields.filter(f => !formData[f.key] || formData[f.key].toString().trim() === "");

            if (missingFields.length > 0) {
              const fieldNames = missingFields.map(f => f.name).join("\n- ");
              alert("VUI LÒNG ĐIỀN ĐẦY ĐỦ CÁC TRƯỜNG THÔNG TIN (*)\n\nCác thông tin bạn còn thiếu là:\n- " + fieldNames);
              return;
            }
            
            let updatedList;
            if (editingIndex !== null) {
              // Cập nhật
              updatedList = [...dataList];
              updatedList[editingIndex] = formData;
              setDataList(updatedList);
              setEditingIndex(null);
              showNotification("Đã cập nhật bản ghi thành công!");
            } else {
              // Thêm mới
              updatedList = [...dataList, formData];
              setDataList(updatedList);
              showNotification("Đã thêm thuốc vào danh sách!");
            }
            
            localStorage.setItem('pharmaImportData', JSON.stringify(updatedList));
            
            setFormData({
              ...initialForm,
              NHA_CUNG_CAP: formData.NHA_CUNG_CAP,
              NUOC_SX: formData.NUOC_SX,
              STT: formData.STT && editingIndex === null ? (parseInt(formData.STT) + 1).toString() : ""
            });
          };

          // Chuyển sang chế độ sửa
          const handleEdit = (index) => {
            setEditingIndex(index);
            setFormData(dataList[index]);
            window.scrollTo({ top: 0, behavior: 'smooth' });
          };

          // Hủy chế độ sửa
          const handleCancelEdit = () => {
            setEditingIndex(null);
            setFormData({
              ...initialForm,
              NHA_CUNG_CAP: formData.NHA_CUNG_CAP,
              NUOC_SX: formData.NUOC_SX,
              STT: dataList.length > 0 ? (parseInt(dataList[dataList.length - 1].STT) + 1).toString() : ""
            });
          };

          // Xử lý Xóa 1 dòng
          const handleDelete = (index) => {
            if (window.confirm("Bạn có chắc muốn xóa bản ghi này?")) {
              const updatedList = dataList.filter((_, i) => i !== index);
              setDataList(updatedList);
              localStorage.setItem('pharmaImportData', JSON.stringify(updatedList));
            }
          };

          // Xóa toàn bộ dữ liệu
          const handleClearAll = () => {
            if (window.confirm("CẢNH BÁO: Xóa toàn bộ dữ liệu hiện có? Dữ liệu chưa xuất file sẽ bị mất vĩnh viễn!")) {
              setDataList([]);
              localStorage.removeItem('pharmaImportData');
              showNotification("Đã làm sạch toàn bộ dữ liệu.");
            }
          };

          // Xử lý Đăng nhập
          const handleLogin = (e) => {
            e.preventDefault();
            if (passwordInput === "1402") {
              setIsAuthenticated(true);
              sessionStorage.setItem('pharmaAuth', 'true');
            } else {
              alert("Mật khẩu không chính xác!");
            }
          };

          // Xử lý Đăng xuất
          const handleLogout = () => {
            setIsAuthenticated(false);
            setPasswordInput("");
            sessionStorage.removeItem('pharmaAuth');
          };

          // Xuất file Excel (.xls)
          const handleExportExcel = () => {
            if (dataList.length === 0) {
              alert("Chưa có dữ liệu để xuất file!");
              return;
            }

            let tableHTML = '<table border="1"><thead><tr>';
            CSV_HEADERS.forEach(header => {
              tableHTML += `<th>${header}</th>`;
            });
            tableHTML += '</tr></thead><tbody>';

            dataList.forEach(item => {
              tableHTML += '<tr>';
              CSV_HEADERS.forEach(header => {
                const cellValue = item[header] ? String(item[header]).replace(/</g, '&lt;').replace(/>/g, '&gt;') : "";
                tableHTML += `<td style='mso-number-format:"\\@"'>${cellValue}</td>`;
              });
              tableHTML += '</tr>';
            });
            tableHTML += '</tbody></table>';

            const template = `
              <html xmlns:o="urn:schemas-microsoft-com:office:office" 
                    xmlns:x="urn:schemas-microsoft-com:office:excel" 
                    xmlns="http://www.w3.org/TR/REC-html40">
              <head>
                <meta charset="UTF-8">
                <!--[if gte mso 9]>
                <xml>
                  <x:ExcelWorkbook>
                    <x:ExcelWorksheets>
                      <x:ExcelWorksheet>
                        <x:Name>Sheet1</x:Name>
                        <x:WorksheetOptions>
                          <x:DisplayGridlines/>
                        </x:WorksheetOptions>
                      </x:ExcelWorksheet>
                    </x:ExcelWorksheets>
                  </x:ExcelWorkbook>
                </xml>
                <![endif]-->
              </head>
              <body>
                ${tableHTML}
              </body>
              </html>
            `;

            const blob = new Blob([template], { type: "application/vnd.ms-excel;charset=utf-8" });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement("a");
            link.href = url;
            link.setAttribute("download", "FILE_IMPORT_THUOC_NEW.xls");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showNotification("Xuất file Excel thành công!");
          };

          // ---------------- MÀN HÌNH ĐĂNG NHẬP ----------------
          if (!isAuthenticated) {
            return (
              <div className="min-h-screen bg-slate-100 flex items-center justify-center font-sans p-4 relative overflow-hidden">
                {/* Background Decoration */}
                <div className="absolute top-[-10%] left-[-10%] w-96 h-96 bg-brand-400 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-pulse"></div>
                <div className="absolute bottom-[-10%] right-[-10%] w-96 h-96 bg-purple-400 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-pulse" style={{ animationDelay: '2s' }}></div>

                <div className="glass-panel p-10 rounded-3xl shadow-[0_8px_30px_rgb(0,0,0,0.08)] w-full max-w-md relative z-10 animate-slide-up">
                  <div className="flex justify-center mb-6">
                    <div className="bg-gradient-to-br from-brand-500 to-indigo-600 p-4 rounded-2xl text-white shadow-lg shadow-brand-500/30">
                      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                    </div>
                  </div>
                  <h2 className="text-3xl font-bold text-center text-slate-800 mb-2">Hệ Thống Nhập Liệu</h2>
                  <p className="text-center text-slate-500 mb-8 font-medium">Vui lòng xác thực để truy cập không gian làm việc</p>
                  
                  <form onSubmit={handleLogin}>
                    <div className="mb-6">
                      <div className="relative">
                        <input 
                          type="password" 
                          value={passwordInput} 
                          onChange={(e) => setPasswordInput(e.target.value)}
                          className="input-modern w-full bg-slate-50/50 border border-slate-200 rounded-xl pl-11 pr-4 py-3.5 text-slate-800 font-medium placeholder-slate-400 focus:outline-none"
                          placeholder="Nhập mã PIN truy cập..."
                          autoFocus
                        />
                        <div className="absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400">
                          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                        </div>
                      </div>
                    </div>
                    <button 
                      type="submit" 
                      className="w-full bg-gradient-to-r from-brand-600 to-indigo-600 hover:from-brand-700 hover:to-indigo-700 text-white font-semibold py-3.5 rounded-xl transition-all duration-300 shadow-md hover:shadow-xl hover:-translate-y-0.5 flex items-center justify-center gap-2"
                    >
                      <span>Truy cập hệ thống</span>
                      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"></path><path d="M12 5l7 7-7 7"></path></svg>
                    </button>
                  </form>
                </div>
              </div>
            );
          }

          // ---------------- MÀN HÌNH CHÍNH ----------------
          return (
            <div className="min-h-screen bg-slate-50/50 text-slate-800 font-sans pb-12 animate-fade-in relative">
              
              {/* Header cố định (Sticky) */}
              <div className="glass-panel sticky top-0 z-30 border-b border-slate-200/60 shadow-sm px-6 py-4 mb-8">
                <div className="max-w-7xl mx-auto flex flex-col sm:flex-row justify-between items-center gap-4">
                  <div className="flex items-center gap-4">
                    <div className="bg-gradient-to-br from-brand-500 to-indigo-600 p-2.5 rounded-xl text-white shadow-md shadow-brand-500/20">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                    </div>
                    <div>
                      <h1 className="text-xl font-bold text-slate-800 leading-tight">Workspace Nhập Liệu</h1>
                      <p className="text-xs font-medium text-slate-500 mt-0.5">Hệ thống đồng bộ dữ liệu Offline</p>
                    </div>
                  </div>

                  <div className="flex items-center gap-3">
                    <button 
                      onClick={handleExportExcel}
                      className="px-5 py-2.5 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white font-semibold rounded-xl flex items-center gap-2 transition-all duration-300 shadow-sm hover:shadow-md hover:-translate-y-0.5"
                    >
                      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                      Xuất File Excel
                    </button>
                    <button 
                      onClick={handleLogout}
                      className="p-2.5 bg-slate-100 hover:bg-slate-200 text-slate-600 font-medium rounded-xl flex items-center gap-2 transition-colors"
                      title="Đăng xuất khỏi hệ thống"
                    >
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                    </button>
                  </div>
                </div>
              </div>

              {/* Layout chính */}
              <div className="max-w-7xl mx-auto px-4 space-y-8">
                
                {/* Thông báo Toast Float */}
                {notification && (
                  <div className="fixed top-24 right-6 z-50 bg-slate-800/95 backdrop-blur-sm text-white px-5 py-3.5 rounded-xl shadow-[0_10px_40px_rgba(0,0,0,0.2)] border border-slate-700 flex items-center gap-3 animate-slide-up">
                    <div className="bg-emerald-500/20 text-emerald-400 p-1.5 rounded-full">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    </div>
                    <span className="font-medium text-sm">{notification}</span>
                  </div>
                )}

                {/* Block: Form nhập liệu */}
                <div className="bg-white p-8 rounded-3xl shadow-[0_4px_24px_rgba(0,0,0,0.03)] border border-slate-100 relative overflow-hidden">
                  <div className={`absolute top-0 left-0 w-1.5 h-full ${editingIndex !== null ? 'bg-amber-500' : 'bg-brand-500'}`}></div>
                  <div className="flex items-center gap-2 mb-6">
                    <h2 className="text-xl font-bold text-slate-800">Thông Tin Khai Báo</h2>
                    {editingIndex !== null ? (
                      <span className="bg-amber-100 text-amber-600 px-2 py-0.5 rounded text-xs font-semibold uppercase tracking-wider animate-pulse">Đang Sửa Dòng {parseInt(editingIndex) + 1}</span>
                    ) : (
                      <span className="bg-slate-100 text-slate-500 px-2 py-0.5 rounded text-xs font-semibold uppercase tracking-wider">Mới</span>
                    )}
                  </div>
                  
                  <form onSubmit={handleSubmit}>
                    <div className="grid grid-cols-1 md:grid-cols-3 xl:grid-cols-4 gap-6">
                      
                      <div className="col-span-1">
                        <label className="block text-sm font-semibold text-slate-700 mb-2">Số Thứ Tự <span className="text-red-500">*</span></label>
                        <input type="number" name="STT" required value={formData.STT} onChange={handleInputChange} className="input-modern w-full bg-slate-50/50 border border-slate-200 rounded-xl px-4 py-2.5 text-slate-800 focus:outline-none placeholder-slate-400" placeholder="VD: 74" />
                      </div>

                      <div className="col-span-1 xl:col-span-2">
                        <label className="block text-sm font-semibold text-slate-700 mb-2">Tên Thuốc Thương Mại <span className="text-red-500">*</span></label>
                        <input type="text" name="TEN_THUOC" required value={formData.TEN_THUOC} onChange={handleInputChange} className="input-modern w-full bg-slate-50/50 border border-slate-200 rounded-xl px-4 py-2.5 text-slate-800 focus:outline-none placeholder-slate-400 font-medium text-brand-700" placeholder="VD: Ambroxol SP 30mg" />
                      </div>

                      <div className="col-span-1 xl:col-span-2">
                        <label className="block text-sm font-semibold text-slate-700 mb-2">Hoạt chất chính <span className="text-red-500">*</span></label>
                        <input type="text" name="HOAT_CHAT" required value={formData.HOAT_CHAT} onChange={handleInputChange} className="input-modern w-full bg-slate-50/50 border border-slate-200 rounded-xl px-4 py-2.5 text-slate-800 focus:outline-none placeholder-slate-400" placeholder="VD: Ambroxol 30mg" />
                      </div>

                      <div className="col-span-1">
                        <label className="block text-sm font-semibold text-slate-700 mb-2">Số Đăng Ký <span className="text-red-500">*</span></label>
                        <input type="text" name="SO_DANG_KY" required value={formData.SO_DANG_KY} onChange={handleInputChange} className="input-modern w-full bg-slate-50/50 border border-slate-200 rounded-xl px-4 py-2.5 text-slate-800 focus:outline-none placeholder-slate-400 font-mono text-sm" placeholder="VD: 893100328923" />
                      </div>

                      <div className="col-span-1">
                        <label className="block text-sm font-semibold text-slate-700 mb-2">Hàm Lượng <span className="text-red-500">*</span></label>
                        <input type="text" name="HAM_LUONG" required value={formData.HAM_LUONG} onChange={handleInputChange} className="input-modern w-full bg-slate-50/50 border border-slate-200 rounded-xl px-4 py-2.5 text-slate-800 focus:outline-none placeholder-slate-400" placeholder="VD: 30mg" />
                      </div>

                      <div className="col-span-1">
                        <label className="block text-sm font-semibold text-slate-700 mb-2">Đơn Vị Tính <span className="text-red-500">*</span></label>
                        <div className="relative">
                          <select name="DON_VI_TINH" required value={formData.DON_VI_TINH} onChange={handleInputChange} className="input-modern w-full bg-slate-50/50 border border-slate-200 rounded-xl pl-4 pr-10 py-2.5 text-slate-800 focus:outline-none appearance-none font-medium">
                            <option value="viên">viên</option>
                            <option value="ống">ống</option>
                            <option value="lọ">lọ</option>
                            <option value="chai">chai</option>
                            <option value="tuýp">tuýp</option>
                            <option value="gói">gói</option>
                            <option value="hộp">hộp</option>
                            <option value="vỉ">vỉ</option>
                            <option value="bơm tiêm">bơm tiêm</option>
                            <option value="túi">túi</option>
                            <option value="ml">ml</option>
                            <option value="lít">lít</option>
                            <option value="gam">gam</option>
                            <option value="kg">kg</option>
                            <option value="bình">bình</option>
                            <option value="liều">liều</option>
                            <option value="cái">cái</option>
                            <option value="bộ">bộ</option>
                          </select>
                          <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500">
                            <svg className="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                          </div>
                        </div>
                      </div>

                      <div className="col-span-1">
                        <label className="block text-sm font-semibold text-slate-700 mb-2">Đóng Gói <span className="text-red-500">*</span></label>
                        <input type="text" name="DONG_GOI" required value={formData.DONG_GOI} onChange={handleInputChange} className="input-modern w-full bg-slate-50/50 border border-slate-200 rounded-xl px-4 py-2.5 text-slate-800 focus:outline-none placeholder-slate-400" placeholder="VD: Hộp 10 vỉ x 10 viên" />
                      </div>

                      {/* Phân vùng logic liên kết (Đường dùng & Mã) */}
                      <div className="col-span-1 xl:col-span-2 grid grid-cols-2 gap-4 p-4 bg-brand-50/50 border border-brand-100 rounded-2xl">
                        <div>
                          <label className="block text-sm font-semibold text-brand-800 mb-2">Đường Dùng <span className="text-red-500">*</span></label>
                          <div className="relative">
                            <select name="DUONG_DUNG" required value={formData.DUONG_DUNG} onChange={handleInputChange} className="input-modern w-full bg-white border border-brand-200 rounded-xl pl-4 pr-10 py-2.5 text-brand-900 focus:outline-none appearance-none font-medium shadow-sm">
                              {DUONG_DUNG_MAPPING.map(d => (
                                <option key={d.code} value={d.name}>{d.name === "" ? "--- Lựa chọn ---" : d.name}</option>
                              ))}
                            </select>
                            <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-brand-500">
                              <svg className="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                            </div>
                          </div>
                        </div>
                        <div>
                          <label className="block text-sm font-semibold text-brand-800 mb-2">Mã Tuyến (Auto) <span className="text-red-500">*</span></label>
                          <input type="text" name="MA_DUONG_DUNG" required value={formData.MA_DUONG_DUNG} onChange={handleInputChange} className="w-full bg-brand-100/50 border border-brand-200/50 text-brand-700 font-mono rounded-xl px-4 py-2.5 cursor-not-allowed text-center tracking-widest font-bold" placeholder="--" readOnly />
                        </div>
                      </div>

                      <div className="col-span-1">
                        <label className="block text-sm font-semibold text-slate-700 mb-2">Hãng Sản Xuất <span className="text-red-500">*</span></label>
                        <input type="text" name="HANG_SX" required value={formData.HANG_SX} onChange={handleInputChange} className="input-modern w-full bg-slate-50/50 border border-slate-200 rounded-xl px-4 py-2.5 text-slate-800 focus:outline-none placeholder-slate-400" placeholder="VD: Shinpoong Daewoo" />
                      </div>

                      <div className="col-span-1">
                        <label className="block text-sm font-semibold text-slate-700 mb-2">Quốc Gia <span className="text-red-500">*</span></label>
                        <input type="text" name="NUOC_SX" required value={formData.NUOC_SX} onChange={handleInputChange} className="input-modern w-full bg-slate-50/50 border border-slate-200 rounded-xl px-4 py-2.5 text-slate-800 focus:outline-none" />
                      </div>

                      <div className="col-span-1 xl:col-span-2">
                        <label className="block text-sm font-semibold text-slate-700 mb-2">Nhà Cung Cấp / Nhập Khẩu <span className="text-red-500">*</span></label>
                        <input type="text" name="NHA_CUNG_CAP" required value={formData.NHA_CUNG_CAP} onChange={handleInputChange} className="input-modern w-full bg-slate-50/50 border border-slate-200 rounded-xl px-4 py-2.5 text-slate-800 focus:outline-none placeholder-slate-400" placeholder="Tên đơn vị trúng thầu..." />
                      </div>

                      <div className="col-span-1 xl:col-span-2">
                        <label className="block text-sm font-semibold text-slate-700 mb-2">Giá Đề Xuất (VNĐ) <span className="text-red-500">*</span></label>
                        <div className="relative">
                          <input type="number" name="GIA_BAN" required value={formData.GIA_BAN} onChange={handleInputChange} className="input-modern w-full bg-slate-50/50 border border-slate-200 rounded-xl pl-4 pr-12 py-2.5 text-slate-800 focus:outline-none font-medium text-emerald-600 placeholder-slate-400" placeholder="1000" />
                          <div className="absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-400 font-medium">₫</div>
                        </div>
                      </div>
                    </div>

                    <div className="mt-8 pt-6 border-t border-slate-100 flex justify-end gap-3">
                      {editingIndex !== null && (
                        <button type="button" onClick={handleCancelEdit} className="px-6 py-3.5 bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold rounded-xl transition-all duration-300">
                          Hủy Sửa
                        </button>
                      )}
                      <button type="submit" className={`px-8 py-3.5 text-white font-semibold rounded-xl flex items-center gap-2.5 transition-all duration-300 shadow-[0_4px_14px_0_rgba(0,0,0,0.1)] hover:-translate-y-0.5 ${editingIndex !== null ? 'bg-amber-500 hover:bg-amber-600 shadow-amber-500/30 hover:shadow-amber-500/40' : 'bg-brand-600 hover:bg-brand-700 shadow-brand-500/30 hover:shadow-brand-500/40'}`}>
                        {editingIndex !== null ? (
                          <>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                            Lưu Cập Nhật
                          </>
                        ) : (
                          <>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                            Thêm Vào Cơ Sở Dữ Liệu
                          </>
                        )}
                      </button>
                    </div>
                  </form>
                </div>

                {/* Block: Bảng dữ liệu */}
                <div className="bg-white rounded-3xl shadow-[0_4px_24px_rgba(0,0,0,0.03)] border border-slate-100 overflow-hidden flex flex-col">
                  <div className="px-8 py-5 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                    <div className="flex items-center gap-3">
                      <h2 className="text-lg font-bold text-slate-800">Kho Dữ Liệu Tạm</h2>
                      <span className="bg-brand-100 text-brand-700 px-3 py-1 rounded-full text-sm font-bold">{dataList.length}</span>
                    </div>
                    {dataList.length > 0 && (
                      <button onClick={handleClearAll} className="text-sm font-semibold text-rose-500 hover:text-rose-700 hover:bg-rose-50 px-4 py-2 rounded-lg transition-colors flex items-center gap-1.5">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                        Làm sạch
                      </button>
                    )}
                  </div>
                  
                  <div className="overflow-x-auto max-h-[500px] w-full relative">
                    <table className="w-full text-sm text-left whitespace-nowrap">
                      <thead className="text-xs text-slate-500 uppercase font-semibold bg-white sticky top-0 z-10 shadow-sm">
                        <tr>
                          <th className="px-6 py-4">STT</th>
                          <th className="px-6 py-4">Tên Thuốc</th>
                          <th className="px-6 py-4">Hoạt Chất</th>
                          <th className="px-6 py-4">Số ĐK</th>
                          <th className="px-6 py-4">Đóng Gói</th>
                          <th className="px-6 py-4">Đường Dùng</th>
                          <th className="px-6 py-4 text-center">Mã Tuyến</th>
                          <th className="px-6 py-4 text-right">Thao tác</th>
                        </tr>
                      </thead>
                      <tbody className="divide-y divide-slate-100">
                        {dataList.length === 0 ? (
                          <tr>
                            <td colSpan="8" className="px-6 py-16 text-center text-slate-400">
                              <div className="flex flex-col items-center justify-center">
                                <svg className="w-12 h-12 mb-3 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                                <p className="font-medium text-base">Không gian trống</p>
                                <p className="text-sm mt-1">Dữ liệu bạn thêm sẽ hiển thị tại đây.</p>
                              </div>
                            </td>
                          </tr>
                        ) : (
                          dataList.map((item, index) => (
                            <tr key={index} className="hover:bg-brand-50/40 transition-colors group">
                              <td className="px-6 py-3.5 font-semibold text-slate-500">{item.STT}</td>
                              <td className="px-6 py-3.5 font-bold text-slate-800">{item.TEN_THUOC}</td>
                              <td className="px-6 py-3.5 text-slate-600">{item.HOAT_CHAT}</td>
                              <td className="px-6 py-3.5 text-slate-600 font-mono text-xs">{item.SO_DANG_KY}</td>
                              <td className="px-6 py-3.5 text-slate-600">{item.DONG_GOI}</td>
                              <td className="px-6 py-3.5">
                                {item.DUONG_DUNG ? (
                                  <span className="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold bg-emerald-100 text-emerald-800 border border-emerald-200">
                                    {item.DUONG_DUNG}
                                  </span>
                                ) : <span className="text-slate-300">-</span>}
                              </td>
                              <td className="px-6 py-3.5 text-center">
                                {item.MA_DUONG_DUNG ? (
                                  <span className="inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-bold font-mono bg-slate-100 text-slate-600">
                                    {item.MA_DUONG_DUNG}
                                  </span>
                                ) : <span className="text-slate-300">-</span>}
                              </td>
                              <td className="px-6 py-3.5 text-right whitespace-nowrap">
                                <button 
                                  onClick={() => handleEdit(index)}
                                  className="text-slate-400 hover:text-amber-500 hover:bg-amber-50 p-2 rounded-lg transition-all opacity-0 group-hover:opacity-100 mr-1"
                                  title="Chỉnh sửa bản ghi này"
                                >
                                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                                </button>
                                <button 
                                  onClick={() => handleDelete(index)}
                                  className="text-slate-400 hover:text-rose-600 hover:bg-rose-50 p-2 rounded-lg transition-all opacity-0 group-hover:opacity-100"
                                  title="Xóa bản ghi này"
                                >
                                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                </button>
                              </td>
                            </tr>
                          ))
                        )}
                      </tbody>
                    </table>
                  </div>
                </div>
                
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
